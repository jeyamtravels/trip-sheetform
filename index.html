<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Trip Sheet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<!-- Signature Pad -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

<script>
(function(){
  emailjs.init("YOUR_PUBLIC_KEY");   // üî¥ REPLACE
})();
</script>

<style>
body{font-family:Arial;background:#f2f2f2;padding:15px}
.sheet{max-width:900px;margin:auto;background:#fff;border:2px solid #333;padding:15px}
h2{text-align:center;letter-spacing:2px}
table{width:100%;border-collapse:collapse;font-size:14px}
td{border:1px solid #333;padding:6px;vertical-align:top}
label{font-weight:bold;display:block;margin-bottom:4px}
input,textarea{width:100%;border:none;outline:none;font-size:14px}
textarea{resize:none}
canvas{border:1px solid #333;width:100%;height:120px}
.actions{margin-top:15px;display:flex;gap:10px}
button{flex:1;padding:10px;font-size:15px;border:none;border-radius:5px;cursor:pointer}
.submit{background:#1a73e8;color:#fff}
.print{background:#1d6f42;color:#fff}
.clear{margin-top:5px;background:#ccc;padding:5px;border:none;width:100%}

@media print{
  body{background:#fff}
  .actions,.clear{display:none}
}
</style>
</head>

<body>

<div class="sheet">
<h2>TRIP SHEET</h2>

<table>
<tr>
<td><label>Service City</label><input id="serviceCity"></td>
<td><label>Organisation</label><input id="organisation"></td>
<td><label>DS.NO</label><input id="dsno"></td>
<td><label>BookingId</label><input id="bookingid"></td>
</tr>
<tr>
<td><label>GuestName</label><input id="guestname"></td>
<td colspan="2"><label>Reporting Address</label><input id="reportAddress"></td>
</tr>
<tr>
<td><label>Start Date</label><input type="date" id="startDate" oninput="calcHrs()"></td>
<td><label>Start Time</label><input type="time" id="startTime" oninput="calcHrs()"></td>
<td><label>Start KM</label><input type="number" id="startKm" oninput="calcKm()"></td>
</tr>

<tr>
<td><label>Close Date</label><input type="date" id="closeDate" oninput="calcHrs()"></td>
<td><label>Close Time</label><input type="time" id="closeTime" oninput="calcHrs()"></td>
<td><label>Close KM</label><input type="number" id="closeKm" oninput="calcKm()"></td>
</tr>

<tr>
<td><label>Total Days</label><input id="totalDays" readonly></td>
<td><label>Total Hours</label><input id="totalHrs" readonly></td>
<td><label>Total KM</label><input id="totalKm" readonly></td>
</tr>

<tr>
<td><label>Driver Name</label><input id="driver"></td>
<td><label>Driver Mobile</label><input id="driverMobile"></td>
<td><label>Car No</label><input id="carNo"></td>
</tr>

<tr>
<td colspan="3"><label>Routing Details</label><textarea rows="2" id="route"></textarea></td>
</tr>

<tr>
<td colspan="3"><label>Toll / Parking</label><textarea rows="2" id="toll"></textarea></td>
</tr>

<tr>
<td>
<label>Guest Signature</label>
<canvas id="custSign"></canvas>
<button type="button" class="clear" onclick="custPad.clear()">Clear</button>
</td>

<td colspan="2">
<label>Chauffeur Signature</label>
<canvas id="driverSign"></canvas>
<button type="button" class="clear" onclick="driverPad.clear()">Clear</button>
</td>
</tr>
</table>

<div class="actions">
<button class="submit" onclick="sendEmail()">Submit</button>
<button class="print" onclick="window.print()">Print</button>
</div>

</div>

<script>
let custPad, driverPad;

window.onload = () => {
  custPad = new SignaturePad(document.getElementById("custSign"));
  driverPad = new SignaturePad(document.getElementById("driverSign"));
};

function calcKm(){
  const s = Number(startKm.value)||0;
  const e = Number(closeKm.value)||0;
  totalKm.value = e>=s ? e-s : 0;
}

function calcHrs(){
  if(!startDate.value||!closeDate.value||!startTime.value||!closeTime.value)return;
  const s = new Date(startDate.value+"T"+startTime.value);
  const e = new Date(closeDate.value+"T"+closeTime.value);
  const d = e - s;
  const mins = Math.floor(d/60000);
  totalHrs.value = Math.floor(mins/60)+"h "+(mins%60)+"m";
  totalDays.value = Math.ceil(d/86400000);
}

function sendEmail(){
  if(custPad.isEmpty() || driverPad.isEmpty()){
    alert("Please sign both Customer & Driver signatures");
    return;
  }

  emailjs.send("YOUR_SERVICE_ID","YOUR_TEMPLATE_ID",{
    serviceCity: serviceCity.value,
    organisation: organisation.value,
    customer: customer.value,
    startDate: startDate.value,
    startTime: startTime.value,
    closeDate: closeDate.value,
    closeTime: closeTime.value,
    startKm: startKm.value,
    closeKm: closeKm.value,
    totalKm: totalKm.value,
    totalHrs: totalHrs.value,
    totalDays: totalDays.value,
    driver: driver.value,
    driverMobile: driverMobile.value,
    carNo: carNo.value,
    route: route.value,
    toll: toll.value,
    custSign: custPad.toDataURL(),
    driverSign: driverPad.toDataURL()
  })
  .then(()=>{
    alert("Trip Sheet sent to Gmail with signature ‚úÖ");
  },err=>{
    alert("Failed ‚ùå "+err.text);
  });
}
</script>

</body>
</html>
